(()=>{"use strict";class t{constructor(){this.basket=document.getElementById("basket"),this.badge=document.querySelector(".badge"),this.cartItems=this.loadFromLocalStorage(),this.updateBadge()}init(){document.addEventListener("click",(t=>{if(t.target&&t.target.classList.contains("buy")){const e=t.target.closest(".contentContainer__bookCards_card"),s=e.querySelector(".title").textContent;if(this.isInBasket(s))this.removeFromBasket(s),t.target.textContent="buy now";else{const i=e.querySelector(".author").textContent,r=e.querySelector(".price").textContent,n=e.querySelector(".imageTitle").style.backgroundImage.slice(5,-2);this.addToBasket({title:s,author:i,price:r,image:n}),t.target.textContent="in the cart"}this.saveToLocalStorage(),this.updateBadge()}}))}isInBasket(t){return this.cartItems.some((e=>e.title===t))}addToBasket(t){this.cartItems.push(t)}removeFromBasket(t){this.cartItems=this.cartItems.filter((e=>e.title!==t))}updateBadge(){const t=this.cartItems.length;this.badge.textContent=t,this.badge.style.display=t>0?"inline-block":"none"}saveToLocalStorage(){localStorage.setItem("cartItems",JSON.stringify(this.cartItems))}loadFromLocalStorage(){const t=localStorage.getItem("cartItems");return t?JSON.parse(t):[]}}class e{constructor(){this.container=document.querySelector(".contentContainer__bookCards"),this.btnLoad=document.querySelector(".contentContainer__btnLoad"),this.maxResults=6,this.startIndex=0,this.currentQuery="Architecture",this.API_KEY="AIzaSyBhwSU5oWcZJUuZ47O8AsM5DC1TPiVSOEE",this.initQuerySelection()}initQuerySelection(){const t=document.querySelectorAll(".catalog__items_item");if(0===t.length)return;t[0].classList.add("active");const e=t[0].textContent.trim();this.fetchBooks(e),t.forEach((e=>{e.addEventListener("click",(()=>{t.forEach((t=>t.classList.remove("active"))),e.classList.add("active");const s=e.textContent.trim();this.currentQuery=s,this.startIndex=0,this.container.innerHTML="",this.fetchBooks(s)}))})),this.btnLoad&&this.btnLoad.addEventListener("click",(()=>this.fetchBooks(this.currentQuery)))}async fetchBooks(t){if(console.log("startIndex:",this.startIndex,"maxResults:",this.maxResults),void 0!==this.startIndex&&void 0!==this.maxResults)try{const e=await fetch(`https://www.googleapis.com/books/v1/volumes?q=${t}&startIndex=${this.startIndex}&maxResults=${this.maxResults}&key=${this.API_KEY}`);console.log(e);const s=await e.json();this.renderBookCards(s.items),this.startIndex+=this.maxResults}catch(t){console.error("Ошибка загрузки данных из Google Books API:",t)}else console.error("startIndex or maxResults is undefined!")}renderBookCards(t){t&&0!==t.length?t.forEach((t=>{const e=t.volumeInfo||{},s=t.saleInfo||{},i=e.imageLinks?.thumbnail||"./image/book-placeholder.jpg",r=e.authors?e.authors.join(", "):"Unknown Author",n=e.title?e.title.substring(0,100)+"...":"No Title",a=this.generateStarRating(e.averageRating),o=e.ratingsCount?`${e.ratingsCount} review`:"",c=e.description?e.description.substring(0,100)+"...":"No description",l=s.retailPrice?`$${s.retailPrice.amount}`:"",d=document.createElement("div");d.className="contentContainer__bookCards_card",d.innerHTML=`\n                <div class="imageTitle" style="background-image: url('${i}');"></div>\n                <div class="descriptionBook">\n                    <div class="author">${r}</div>\n                    <div class="title">${n}</div>\n                    <div class="averageRating">${a}</div>\n                    <div class="ratingCount">${o}</div>\n                    <div class="description">${c}</div>\n                    <div class="price">${l}</div>\n                    <button class="buy">buy now</button>\n                </div>`,this.container.append(d)})):this.container.innerHTML="<p>Книги не найдены</p>"}generateStarRating(t){if(!t)return"";const e=Math.round(t);let s="";for(let t=1;t<=5;t++)s+=`<span class="${t<=e?"star filled":"star empty"}">★</span>`;return`<div class="star-rating">${s}</div>`}}class s{constructor(){this.sliderImages=document.querySelector(".contentSlider__slider_images"),this.sliderDots=document.querySelector(".contentSlider__slider_dots"),this.images=[{url:"./image/banner1.jpg"},{url:"./image/banner2.jpg"},{url:"./image/banner3.jpg"}],this.sliderImages&&this.sliderDots?(this.currentIndex=0,this.intervalTime=5e3,this.initSlider()):console.error("Элементы слайдера не найдены!")}initSlider(){this.images.length&&(this.initImages(),this.initDots(),this.startAutoSlide())}initImages(){this.sliderImages.innerHTML="",this.images.forEach(((t,e)=>{const s=`<div class="contentSlider__slider_image n${e} ${0===e?"active":""}" \n              style="background-image: url(${t.url});" \n              data-index="${e}"></div>`;this.sliderImages.insertAdjacentHTML("beforeend",s)}))}initDots(){this.sliderDots.innerHTML="",this.images.forEach(((t,e)=>{const s=`<div class="contentSlider__dot n${e} ${0===e?"active":""}" data-index="${e}"></div>`;this.sliderDots.insertAdjacentHTML("beforeend",s)})),this.sliderDots.querySelectorAll(".contentSlider__dot").forEach((t=>{t.addEventListener("click",(()=>{this.moveSlider(parseInt(t.dataset.index)),this.resetAutoSlide()}))}))}moveSlider(t){const e=this.sliderImages.querySelector(".active"),s=this.sliderImages.querySelector(`.n${t}`);e&&e.classList.remove("active"),s&&s.classList.add("active");const i=this.sliderDots.querySelector(".active"),r=this.sliderDots.querySelector(`.n${t}`);i&&i.classList.remove("active"),r&&r.classList.add("active"),this.currentIndex=t}startAutoSlide(){this.autoSlideInterval=setInterval((()=>{this.currentIndex=(this.currentIndex+1)%this.images.length,this.moveSlider(this.currentIndex)}),this.intervalTime)}resetAutoSlide(){clearInterval(this.autoSlideInterval),this.startAutoSlide()}}class i{constructor(){this.slider=new s,this.bookCards=new e,this.basket=new t,this.basket.init()}}document.addEventListener("DOMContentLoaded",(function(){new i}))})();